<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' https://us.i.posthog.com https://fonts.googleapis.com;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
  font-src 'self' https://fonts.gstatic.com;
  img-src 'self' data: https:;
  connect-src 'self' https://us.i.posthog.com https://*.railway.app;
">
  <title>ContactsMind</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#8b5cf6">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ContactsMind">
  <script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://us.i.posthog.com">
  
  <!-- DNS Prefetch -->
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://us.i.posthog.com">
  
  <!-- Preload critical resources -->
  <link rel="preload" href="styles.css" as="style">
  <link rel="preload" href="js/loader.js" as="script">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-container">
    <header class="header">
      <div class="logo">
        <div class="logo-icon">CM</div>
        <span class="logo-text">ContactsMind</span>
      </div>
      <div class="header-actions">
        <button class="icon-btn" id="theme-toggle-btn" onclick="Theme.toggle()" title="Toggle Theme">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </button>
        <button class="icon-btn" onclick="openFeedback()" title="Feedback">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            <path d="M12 7v2"></path>
            <path d="M12 13h.01"></path>
          </svg>
        </button>
        <button class="icon-btn" onclick="openQuickAdd()" title="Quick Add">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <line x1="19" y1="8" x2="19" y2="14"></line>
            <line x1="16" y1="11" x2="22" y2="11"></line>
          </svg>
        </button>
        <button class="icon-btn" id="calendar-connect-btn" title="Google Calendar">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
        </button>
        <button class="icon-btn" id="theme-toggle-btn" onclick="Theme.toggle()" title="Toggle Theme">
          <!-- theme icon -->
        </button>
        <button class="icon-btn" onclick="handleLogout()" title="Logout">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
        </button>
      </div>
    </header>

    <nav class="nav-tabs">
      <button class="tab active" onclick="switchView('chat')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        Chat
      </button>
      <button class="tab" onclick="switchView('contacts')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        Contacts
        <span class="tab-badge" id="contact-count">0</span>
      </button>
    </nav>

    <main class="chat-view" id="chat-view">
      <div class="messages" id="messages"></div>
      <div class="input-area">
        <div class="input-container">
          <input type="text" id="message-input" placeholder="Tell me about a contact..." autocomplete="off">
          <button class="send-btn" onclick="sendMessage()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </button>
        </div>
      </div>
    </main>

    <div class="contacts-view hidden" id="contacts-view">
  <div class="contacts-header">
    <div>
      <h1 class="contacts-title">Contacts</h1>
      <span class="contacts-count" id="contacts-count-text">0 contacts</span>
    </div>
    <div class="contacts-header-actions">
      <button class="icon-btn" onclick="openExportModal()" title="Export">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
      </button>
      <button class="icon-btn" onclick="openImportModal()" title="Import">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="17 8 12 3 7 8"></polyline>
          <line x1="12" y1="3" x2="12" y2="15"></line>
        </svg>
      </button>
    </div>
  </div>
  <div class="contacts-grid" id="contacts-grid"></div>
</div>
  </div>

  <!-- Quick Add Modal -->
  <div class="modal-overlay hidden" id="quick-add-modal" onclick="closeQuickAdd()">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Add Contact</h2>
        <button class="modal-close" onclick="closeQuickAdd()">√ó</button>
      </div>
      <div class="form-group">
        <label class="form-label">Name *</label>
        <input type="text" class="form-input" id="qa-name" placeholder="John Smith">
      </div>
      <div class="form-group">
        <label class="form-label">Phone</label>
        <input type="tel" class="form-input" id="qa-phone" placeholder="555-123-4567">
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="qa-email" placeholder="john@example.com">
      </div>
      <div class="form-group">
        <label class="form-label">Skills (comma separated)</label>
        <input type="text" class="form-input" id="qa-skills" placeholder="photography, design">
      </div>
      <div class="form-group">
        <label class="form-label">Notes</label>
        <textarea class="form-input" id="qa-notes" placeholder="Met at coffee shop..."></textarea>
      </div>
      <button class="btn btn-primary btn-block" onclick="submitQuickAdd()">Add Contact</button>
    </div>
  </div>

  <!-- Edit Contact Modal -->
  <div class="modal-overlay hidden" id="edit-modal" onclick="closeEditModal()">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Edit Contact</h2>
        <button class="modal-close" onclick="closeEditModal()">√ó</button>
      </div>
      <input type="hidden" id="edit-contact-id">
      <div class="form-group">
        <label class="form-label">Name</label>
        <input type="text" class="form-input" id="edit-name">
      </div>
      <div class="form-group">
        <label class="form-label">Phone</label>
        <input type="tel" class="form-input" id="edit-phone">
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="edit-email">
      </div>
      <div class="form-group">
        <label class="form-label">Skills (comma separated)</label>
        <input type="text" class="form-input" id="edit-skills">
      </div>
      <button class="btn btn-primary btn-block" id="save-edit-btn">Save Changes</button>
    </div>
  </div>

  <!-- Notes Modal -->
  <div class="modal-overlay hidden" id="notes-modal" onclick="closeNotesModal()">
    <div class="modal modal-lg" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -4px; margin-right: 8px; color: var(--info);">
            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <line x1="10" y1="9" x2="8" y2="9"></line>
          </svg>
          Notes for <span id="notes-contact-name"></span>
        </h2>
        <button class="modal-close" onclick="closeNotesModal()">√ó</button>
      </div>
      <input type="hidden" id="notes-contact-id">
      
      <div class="notes-list" id="notes-list"></div>
      
      <div class="form-group" style="margin-top: 16px;">
        <label class="form-label">Add New Note</label>
        <textarea class="form-input" id="new-note-text" rows="3" placeholder="Write a note..."></textarea>
      </div>
      <button class="btn btn-primary btn-block" onclick="addNote()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Add Note
      </button>
    </div>
  </div>

  <!-- Reminders Modal -->
  <div class="modal-overlay hidden" id="reminders-modal" onclick="closeRemindersModal()">
    <div class="modal modal-lg" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -4px; margin-right: 8px; color: var(--warning);">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          Reminders for <span id="reminders-contact-name"></span>
        </h2>
        <button class="modal-close" onclick="closeRemindersModal()">√ó</button>
      </div>
      <input type="hidden" id="reminders-contact-id">
      
      <div class="reminders-list" id="reminders-list"></div>
      
      <div class="add-reminder-section" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-subtle);">
        <div class="form-group">
          <label class="form-label">Title</label>
          <input type="text" class="form-input" id="reminder-title" placeholder="Call back, Follow up...">
        </div>
        <div class="form-row">
          <div class="form-group" style="flex: 1;">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" id="reminder-date">
          </div>
          <div class="form-group" style="flex: 1;">
            <label class="form-label">Time</label>
            <input type="time" class="form-input" id="reminder-time" value="09:00">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Notes (optional)</label>
          <textarea class="form-input" id="reminder-notes" rows="2" placeholder="Details..."></textarea>
          <div class="form-group" id="calendar-checkbox-group" style="display: none;">
            <label class="checkbox-label">
              <input type="checkbox" id="reminder-add-calendar">
              <span>Add to Google Calendar</span>
            </label>
          </div>
        </div>
        <button class="btn btn-primary btn-block" onclick="addReminder()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Add Reminder
        </button>
      </div>
    </div>
  </div>

  <!-- Feedback Modal -->
  <div class="modal-overlay hidden" id="feedback-modal" onclick="closeFeedback()">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Send Feedback</h2>
        <button class="modal-close" onclick="closeFeedback()">√ó</button>
      </div>
      <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 13px;">Help us improve ContactsMind!</p>
      <div class="form-group">
        <label class="form-label">How's your experience?</label>
        <div class="rating-buttons">
          <button type="button" class="rating-btn" data-rating="1">üòû</button>
          <button type="button" class="rating-btn" data-rating="2">üòê</button>
          <button type="button" class="rating-btn" data-rating="3">üôÇ</button>
          <button type="button" class="rating-btn" data-rating="4">üòä</button>
          <button type="button" class="rating-btn" data-rating="5">ü§©</button>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">What can we improve?</label>
        <textarea class="form-input" id="feedback-text" rows="3" placeholder="Tell us what you think..."></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">Feedback type</label>
        <select class="form-input" id="feedback-type">
          <option value="general">General feedback</option>
          <option value="bug">Bug report</option>
          <option value="feature">Feature request</option>
          <option value="other">Other</option>
        </select>
      </div>
      <button class="btn btn-primary btn-block" onclick="submitFeedback()">Send Feedback</button>
    </div>
  </div>
<!-- Export Modal -->
<div class="modal-overlay hidden" id="export-modal" onclick="closeExportModal()">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Export Contacts</h2>
      <button class="modal-close" onclick="closeExportModal()">√ó</button>
    </div>
    <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 13px;">
      Choose a format to export your contacts
    </p>
    <div class="export-options">
      <button class="export-option" onclick="exportContactsCSV(); closeExportModal();">
        <div class="export-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
          </svg>
        </div>
        <div class="export-info">
          <strong>CSV File</strong>
          <span>Works with Excel, Google Sheets</span>
        </div>
      </button>
      <button class="export-option" onclick="exportContactsVCard(); closeExportModal();">
        <div class="export-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
        <div class="export-info">
          <strong>vCard File</strong>
          <span>Works with iPhone, Android, Outlook</span>
        </div>
      </button>
    </div>
  </div>
</div>

<!-- Import Modal -->
<div class="modal-overlay hidden" id="import-modal" onclick="closeImportModal()">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Import Contacts</h2>
      <button class="modal-close" onclick="closeImportModal()">√ó</button>
    </div>
    <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 13px;">
      Upload a CSV or vCard file to import contacts
    </p>
    <div class="import-dropzone" id="import-dropzone" onclick="document.getElementById('import-file').click()">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="17 8 12 3 7 8"></polyline>
        <line x1="12" y1="3" x2="12" y2="15"></line>
      </svg>
      <span>Click to upload or drag & drop</span>
      <span class="import-formats">CSV or vCard (.vcf)</span>
    </div>
    <input type="file" id="import-file" accept=".csv,.vcf,.vcard" style="display: none;" onchange="handleImportFile(event)">
    <div id="import-preview" class="import-preview hidden"></div>
    <button class="btn btn-primary btn-block hidden" id="import-confirm-btn" onclick="confirmImport()">
      Import Contacts
    </button>
  </div>
</div>
<!-- Calendar Options Modal -->
<div class="modal-overlay hidden" id="calendar-options-modal" onclick="Calendar.closeOptions()">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:20px;height:20px;margin-right:8px;">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        Google Calendar
      </h2>
      <button class="modal-close" onclick="Calendar.closeOptions()">√ó</button>
    </div>
    
    <div class="calendar-options">
      <button class="calendar-option" onclick="Calendar.syncAllReminders()">
        <div class="calendar-option-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path>
            <path d="M21 3v5h-5"></path>
          </svg>
        </div>
        <div class="calendar-option-info">
          <strong>Sync All Reminders</strong>
          <span>Add all reminders to your calendar</span>
        </div>
      </button>
      
      <button class="calendar-option disconnect" onclick="Calendar.disconnect()">
        <div class="calendar-option-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
            <line x1="12" y1="2" x2="12" y2="12"></line>
          </svg>
        </div>
        <div class="calendar-option-info">
          <strong>Disconnect Calendar</strong>
          <span>Remove Google Calendar integration</span>
        </div>
      </button>
    </div>
  </div>
</div>
  
  <script src="js/loader.js"></script>
</body>
</html>